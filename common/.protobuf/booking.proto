syntax = "proto3";

option go_package="handworks/common/grpc/booking";
import "google/protobuf/timestamp.proto";

service BookingService {
  rpc CreateBooking(CreateBookingRequest) returns (CreateBookingResponse);
  rpc CalculatePrice(CalculatePriceRequest) returns (CalculatePriceResponse);
  rpc GetBookingById(GetBookingByIdRequest) returns (GetBookingByIdResponse);
}

message Address {
    string address_human = 1;
    double address_lat = 2;
    double address_lng = 3;
}

message CleaningEquipment {
  string id = 1;
  string name = 2;
  string type = 3;
  string photo_url = 4;
}

message CleaningResources {
  string id = 1;
  string name = 2;
  string type = 3;
  string photo_url = 4;
}

message CleanerAssigned {
  string id = 1;
  string cleaner_first_name = 2;
  string cleaner_last_name = 3;
  string pfp_url = 4;
}

message ServiceDetail {
  oneof type {
    GeneralCleaningDetails general = 1;
    CouchCleaningDetails couch = 2;
    MattressCleaningDetails mattress = 3;
    CarCleaningDetails car = 4;
    PostConstructionCleaningDetails post = 5;
  }
}

message Booking {
  string id = 1;
  BaseBookingDetails base = 2;
  ServiceDetail main_service = 3;
  repeated AddOn addons = 4;
  repeated CleaningEquipment equipment = 5;
  repeated CleaningResources resources = 6;
  repeated CleanerAssigned cleaners = 7;
  float total_price = 8;
}

message AddOn {
  string id = 1;
  ServiceDetail serviceDetail = 2;
  float price = 3;
}

message BaseBookingDetails {
    string id = 1;
    string cust_id = 2;
    string customer_first_name = 3;
    string customer_last_name = 4;
    Address address = 5;
    google.protobuf.Timestamp schedule = 6;
    int32 dirty_scale = 7; // 1 - 5
    string payment_status = 8;
    string review_status = 9;
    repeated string photos = 10; // file IDs or URLs
    google.protobuf.Timestamp created_at = 11;
    google.protobuf.Timestamp updated_at = 12;
}

message BaseBookingDetailsCreate {
    string cust_id = 1;
    string customer_first_name = 2;
    string customer_last_name = 3;
    Address address = 4;
    google.protobuf.Timestamp schedule = 5;
    int32 dirty_scale = 6; // 1 - 5
    string payment_status = 7;
    string review_status = 8;
    repeated string photos = 9; // file IDs or URLs
}

message CreateBookingRequest {
  BaseBookingDetailsCreate base = 1;
  ServiceDetail main_service = 2;
  repeated AddOn addons = 3;
  repeated CleaningEquipment equipment = 4;
  repeated CleaningResources resources = 5;
  repeated CleanerAssigned cleaners = 6;
}

message CreateBookingResponse {
  string booking_id = 1;
}

enum HomeType {
    CONDO_ROOM = 0;
    HOUSE = 1;
    COMMERCIAL = 2;
}
enum CouchType {
    SEATER_1 = 0;
    SEATER_2 = 1;
    SEATER_3 = 2;
    SEATER_3_LTYPE_SMALL = 3;
    SEATER_3_LTYPE_LARGE = 4;
    SEATER_4_LTYPE_SMALL = 5;
    SEATER_4_LTYPE_LARGE = 6;
    SEATER_5_LTYPE = 7;
    SEATER_6_LTYPE = 8;
    OTTOMAN = 9;
    LAZBOY = 10;
    CHAIR = 11;
}
enum BedType {
    KING = 0;
    QUEEN = 1;
    KING_HEADBAND = 2;
    QUEEN_HEADBAND = 3;
    DOUBLE = 4;
    SINGLE = 5;
    BED_PILLOW = 6;
}
enum CarType {
    SEDAN = 0;
    MPV = 1;
    SUV = 2;
    PICKUP = 3;
    VAN = 4;
    CAR_SMALL = 5;    
}
// General cleaning
message GeneralCleaningDetails {
  HomeType home_type = 1;
  int32 sqm = 2;
}

// Couch cleaning
message CouchCleaningDetails {
  CouchType couch_type = 1;
  int32 width_cm = 2;
  int32 depth_cm = 3;
  int32 height_cm = 4;
}

// Mattress cleaning
message MattressCleaningDetails {
  BedType bed_type = 1;
  int32 width_cm = 2;
  int32 depth_cm = 3;
  int32 height_cm = 4;
}

// Car interior cleaning
message CarCleaningDetails {
  CarType car_type = 1;
  int32 child_seats = 2;
}

// Post-construction cleaning
message PostConstructionCleaningDetails {
  int32 sqm = 1;
}

message CalculatePriceRequest {
  CreateBookingRequest booking = 1;
}

message CalculatePriceResponse {
  float base_price = 1;
  float adjustments = 2;
  float addons_price = 3;
  float total_price = 4;
  repeated PricingBreakdown breakdown = 5;
}

message PricingBreakdown {
  string description = 1;
  float amount = 2;
}

message GetBookingByIdRequest {
  string booking_id = 1;
}

message GetBookingByIdResponse {
  Booking booking = 1;
}

